<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>JSONデッキ対応クイズ｜反復出題（全問正解まで）</title>
<style>
  :root{
    --bg: #0b1020;
    --panel: #121a2e;
    --panel-2:#0f1628;
    --ink: #e6ecff;
    --ink-dim:#b6c2e6;
    --accent: #5b8cff;
    --accent-2:#89a9ff;
    --good:#22c55e;
    --bad:#ef4444;
    --warn:#f59e0b;
  }
  body{
    margin:0; background:linear-gradient(180deg, var(--bg), #0a0f1a 55%);
    color:var(--ink); font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Sans", "Noto Sans JP", Meiryo, sans-serif;
  }
  .wrap{ max-width: 1100px; margin:0 auto; padding:16px; display:grid; gap:16px; }
  header{ display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content:space-between; }
  header h1{ font-size:clamp(18px,5vw,26px); margin:0; }
  .toolbar{ display:flex; flex-wrap:wrap; gap:8px; }
  .btn{ border:1px solid transparent; border-radius:12px; padding:10px 14px; font-weight:600; cursor:pointer; }
  .btn{ background:var(--accent); color:#fff; }
  .btn.secondary{ background:transparent; border-color:#2c3a63; color:var(--ink); }
  .btn.good{ background:var(--good); color:#fff; }
  .btn.bad{ background:var(--bad); color:#fff; }

  .grid{ display:grid; grid-template-columns:2fr 1fr; gap:16px; }
  @media(max-width:768px){ .grid{ grid-template-columns:1fr; } }

  .card{ background:linear-gradient(180deg,var(--panel),var(--panel-2)); border:1px solid #1b2441; border-radius:16px; padding:16px; }
  .hint{ background:#0d162f; border:1px dashed #2a3b6b; border-radius:12px; padding:10px 12px; margin-bottom:10px; }
  .feedback{ margin-top:10px; padding:10px 12px; border-radius:12px; border:1px solid #263461; }
  .feedback.good{ background:rgba(34,197,94,.12); border-color:rgba(34,197,94,.4); }
  .feedback.bad{ background:rgba(239,68,68,.12); border-color:rgba(239,68,68,.4); }
  .imgbox{ border:1px solid #1b2441; border-radius:12px; overflow:hidden; background:#0b1329; margin-bottom:10px; }
  .imgbox img{ width:100%; height:min(45vh, 320px); object-fit:contain; display:block; background:#0b1329; }
  .imgbox .imgcap{ padding:8px 10px; color:var(--ink-dim); font-size:.9rem; border-top:1px solid #1b2441; }
  @media(max-width:768px){ .imgbox img{ height:min(40vh, 260px); } }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>JSONデッキ対応・クイズ（反復出題）</h1>
    <div class="toolbar">
      <label class="btn secondary" for="file">JSONをアップロード</label>
      <input id="file" type="file" accept="application/json" style="display:none" />
      <button class="btn secondary" id="btnSample">サンプル読込</button>
    </div>
  </header>

  <div class="grid">
    <section class="card">
      <h2 id="qHeader">デッキ未読込</h2>
      $1

      <div id="clearedBar" style="color:#b6c2e6;margin:6px 0 8px">クリア: <b id="clearedCount">0</b> / <span id="totalCount">0</span></div>

      <div id="quizArea" style="display:none">
        <div class="hint" id="hintBox"></div>
        <input id="answer" type="text" placeholder="ここに解答を入力" style="width:100%;padding:8px;font-size:16px;" />
        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn" id="btnSubmit">解答</button>
          <button class="btn secondary" id="btnSkip">スキップ</button>
              <button class="btn good" id="btnNext" style="display:none">次の問題へ</button>
        </div>
        <div id="feedback" class="feedback" style="display:none"></div>
        <details id="detailsBox" style="margin-top:12px; display:none">
          <summary>解説を表示</summary>
          <div id="desc"></div>
        </details>
        
      </div>

      <div id="doneArea" style="display:none">
        <h2>全問正解！</h2>
        <button class="btn good" id="btnRestart">もう一度</button>
      </div>
    </section>

    <aside class="card" id="right">
      <h2>情報</h2>
      <div class="imgbox" id="imgBox" style="display:none"><img id="img" alt="関連画像" /><div class="imgcap" id="imgCap"></div></div>
      <div id="miniDesc"></div>
    </aside>
  </div>
</div>

<script>
(function(){
  const state={deck:[],queue:[],current:null,correct:0,cleared:new Set()};
  $1
  const clearedCount = document.getElementById('clearedCount');
  const totalCount = document.getElementById('totalCount');
  function renderCleared(){ if(totalCount){ totalCount.textContent = state.deck.length; } if(clearedCount){ clearedCount.textContent = state.cleared.size; } }
  function setDeck(arr){ state.deck=arr.map((d,i)=>({...d,_id:i})); state.queue=[...state.deck.map(d=>d._id)]; state.cleared = new Set(); renderCleared(); nextQuestion(); })); state.queue=[...state.deck.map(d=>d._id)]; nextQuestion(); }
  function nextQuestion(){ if(state.queue.length===0){ $('#quizArea').style.display='none'; $('#doneArea').style.display='block'; return; }
    state.current=state.queue.shift(); const item=state.deck.find(d=>d._id===state.current);
    $('#qHeader').textContent='この用語は？'; $('#deckSub').textContent='';
    (function(){ try{ const box=document.getElementById('imgBox'); if(!box) return; const i=document.getElementById('img'); const cap=document.getElementById('imgCap'); const im=item&&item.image; if(im && (im.commonsTitle||im.url)){ const url= im.commonsTitle ? ('https://commons.wikimedia.org/wiki/Special:FilePath/'+encodeURIComponent(String(im.commonsTitle).replace(/^File:/,''))+'?width=1200') : im.url; i.src=url; i.alt=im.note||'関連画像'; cap.textContent= im.note || (String(im.commonsTitle||'').replace(/^File:/,'')); box.style.display='block'; } else { box.style.display='none'; } }catch(_){} })();
    renderCleared();
    $('#hintBox').textContent=item.hint||'';
    $('#answer').value=''; document.getElementById('btnNext').style.display='none'; $('#feedback').style.display='none'; $('#detailsBox').style.display='none'; $('#btnNext').style.display='none';
    $('#quizArea').style.display='block'; }
  function onSubmit(){ const item=state.deck.find(d=>d._id===state.current); const ans=$('#answer').value.trim();
    if(ans && (ans===item.term || (item.aliases||[]).includes(ans))){ $('#feedback').className='feedback good'; $('#feedback').textContent='正解！ '+item.term; state.cleared.add(state.current); renderCleared(); }
    else { $('#feedback').className='feedback bad'; $('#feedback').textContent='不正解… 正答は '+item.term; state.queue.push(state.current); }
    $('#feedback').style.display='block'; $('#detailsBox').style.display='block'; $('#desc').textContent=item.background||''; document.getElementById('btnNext').style.display='inline-block'; $('#btnNext').style.display='inline-block'; }
  $('#btnSubmit').addEventListener('click',onSubmit); $('#btnSkip').addEventListener('click',()=>{ const item=state.deck.find(d=>d._id===state.current); $('#feedback').className='feedback bad'; $('#feedback').textContent='スキップ：正答は '+(item ? item.term : ''); $('#feedback').style.display='block'; $('#detailsBox').style.display='block'; $('#desc').textContent=item && item.background ? item.background : ''; state.queue.push(state.current); document.getElementById('btnNext').style.display='inline-block'; }); $('#btnNext').addEventListener('click',nextQuestion);
  $('#btnRestart').addEventListener('click',()=>setDeck(state.deck));
  $('#file').addEventListener('change',async e=>{const f=e.target.files[0]; if(!f)return; const txt=await f.text(); setDeck(JSON.parse(txt));});
  $('#btnSample').addEventListener('click',()=>{setDeck([{term:"飛鳥文化",aliases:["あすかぶんか"],hint:"日本最初の仏教文化、飛鳥寺が中心",background:"百済から仏教が公伝し寺院建築が盛んになった。"}]);});
})();
</script>
</body>
</html>
